<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='stylesheet'
          href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css'>
    <link rel='stylesheet'
          href='https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css'>
    <link rel="stylesheet" href="/css/style.css">

    <!-- Demo CSS -->
    <link rel="stylesheet" href="/css/demo.css">

    <title>Add product</title>
</head>
<body>

<header th:insert="navbar.html :: header"></header>

<!--/*@thymesVar id="product" type="com.struninproject.onlinestore.model.Product"*/-->
<form action="#" th:action="@{/product/new}" th:object="${product}"
      method="POST">
    <label for="name">Name</label>
    <input type="text" th:field="*{name}" id="name" placeholder="name">
    <!--    <span th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></span>-->
    <br>
    <!--/*@thymesVar id="price" type="java.math.BigDecimal"*/-->
    <label for="price">Price</label>
    <input type="text" th:field="*{price}" id="price" placeholder="price">
    <!--    <span th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></span>-->
    <br>
    <!--/*@thymesVar id="image" type="java.lang.String"*/-->
    <label for="image">Image</label>
    <input type="text" th:field="*{image}" id="image" placeholder="image">
    <!--    <span th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></span>-->
    <br>
    <!--/*@thymesVar id="description" type="java.lang.String"*/-->
    <label for="description">Description</label>
    <input type="text" th:field="*{description}" id="description"
           placeholder="description">
    <!--    <span th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></span>-->
    <br>


    <!--/*@thymesVar id="manufacturers" type="java.lang.Iterable"*/-->
    <!--/*@thymesVar id="manufacturer" type="com.struninproject.onlinestore.model.Manufacturer"*/-->
    <div class="form-group">
        <label for="manufacturer">Manufacturer</label>
        <select class="form-control" th:field="*{manufacturer}"
                id="manufacturer">
            <option th:each="manufacturer : ${manufacturers}"
                    th:value="${manufacturer.getId()}"
                    th:text="${manufacturer.getName()}"></option>
        </select>
        <!--    <span th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></span>-->
    </div>

    <br>

    <!--/*@thymesVar id="categories" type="java.lang.Iterable"*/-->
    <!--/*@thymesVar id="category" type="com.struninproject.onlinestore.model.Category"*/-->
    <div id="out" class="form-group">
        <label for="category">Category</label>
<!--        <select onchange="myChangeFunction(this.value)" class="form-control"-->
        <select class="form-control"
                th:field="*{category}" id="category">
            <option th:each="category : ${categories}"
                    th:value="${category.getId()}"
                    th:text="${category.getName()}"></option>
        </select>
    </div>
    <!--    <span th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></span>-->

    <!--/*@thymesVar id="specifications" type="java.util.Map"*/-->
    <label for="specifications">Specifications</label>
    <input type="" th:field="*{specifications}" id="specifications"
           placeholder="specifications" value="{ 'firstName':'John' , 'lastName':'Doe' }">
    <!--    <span th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></span>-->
    <br>

<!--    <tr>-->
<!--        <th>KEY</th>-->
<!--        <th>VALUE</th>-->
<!--    </tr>-->
    <!--    <div th:each="pr, stat: *{specifications}">-->
    <!--        <tr>-->
    <!--            <td><input type="text" name="mergeMapKey" th:value="${pr.key}" /></td>-->
    <!--            <td><input type="text" name="mergeMapValue" th:value="${pr.value}" /></td>-->
    <!--        </tr>-->
    <!--    </div>-->

    <div th:each="pr, stat: *{specifications}">
        <tr>
            <td><input type="text" name="value" th:value="${pr.key}"
                       readonly="true"/></td>
            <td><input type="text" name="value"
                       th:field="*{specifications[__${pr.key}__]}"/></td>
        </tr>
    </div>


    <!--    <label for="specifications">Specifications</label>-->
    <!--    <input type="text" th:field="*{specifications}" id="specifications" placeholder="specifications">-->
    <!--    <select th:field="*{specifications}">-->
    <!--        <option th:each="key : ${mapCountries.keySet()}"-->
    <!--                th:value="${key}"-->
    <!--                th:utext="${mapCountries.get(key)}">-->
    <!--        </option>-->
    <!--    </select>-->

    <br>
    <input type="submit" value="Add product">
</form>

<script th:inline="javascript">
    function myChangeFunction(value) {
        const categories = /*[[${categories}]]*/ {};
        let elInput;
        let elLabel;
        let br;
        const elementById = document.getElementById('in');
        if (elementById){
            elementById.remove();
        }
        const form = document.getElementById("out");
        const divIN = document.createElement('div');
        divIN.setAttribute('id', 'in');
        for (let index in categories) {
            const category = categories[index];
            if (category.id === value) {
                for (let i in category.features) {
                    elLabel = document.createElement('label');
                    elLabel.setAttribute('for', category.features[i])
                    elLabel.innerText = category.features[i];
                    elInput = document.createElement('input');
                    elInput.setAttribute('placeholder', category.features[i]);
                    elInput.setAttribute('id', category.features[i]);
                    elInput.setAttribute('name', 'specifications');
                    divIN.appendChild(elLabel);
                    br = document.createElement('br');
                    divIN.appendChild(br);
                    divIN.appendChild(elInput);
                    br = document.createElement('br');
                    divIN.appendChild(br);
                }
                form.appendChild(divIN);
            }
        }
    }
</script>

<!-- jQuery -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
<!-- Bootstrap JS -->
<script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>

</body>
</html>